"use strict";(self.webpackChunkreact_admin=self.webpackChunkreact_admin||[]).push([[424],{8424:function(t,e,a){a.r(e),a.d(e,{default:function(){return _}});var n=a(5861),r=a(5671),s=a(3144),i=a(9340),c=a(8557),u=a(7757),o=a.n(u),d=a(7363),l=a.n(d),m=a(1821),f=a(5796),h=a(9286),p=a(7467),g=a.n(p),b=a(184),v=m.Tabs.TabPane,x=m.Modal.confirm,_=function(t){(0,i.Z)(a,t);var e=(0,c.Z)(a);function a(){var t;(0,r.Z)(this,a);for(var s=arguments.length,i=new Array(s),c=0;c<s;c++)i[c]=arguments[c];return(t=e.call.apply(e,[this].concat(i))).tagInputRef=l().createRef(),t.addFormRef=l().createRef(),t.editFormRef=l().createRef(),t.columns=[{title:"#",key:"index",render:function(t,e,a){return a+1}},{width:"50%",title:"\u540d\u79f0",dataIndex:"attr_name",key:"goods_name"},{width:"30%",title:"\u64cd\u4f5c",key:"operation",render:function(e,a){return(0,b.jsxs)(m.Space,{children:[(0,b.jsx)(m.Button,{type:"primary",onClick:function(){t.showEditModal(a)},children:"\u7f16\u8f91"}),(0,b.jsx)(m.Button,{danger:!0,className:"dangerStyle",onClick:function(){t.showRemoveConfirm(a.attr_id)},children:"\u5220\u9664"})]})}}],t.state={cateList:[],goods_cat_threeId:"",defaultDynamicParams:[],defaultStaticAttributes:[],addForm:{attr_name:""},editForm:{attr_id:"",attr_name:""},addModalVisible:!1,editModalVisible:!1,activeTabName:"many",checkedCateList:[],loading:!1},t.showAddModal=function(){t.setState({addModalVisible:!0})},t.showEditModal=function(e){var a={attr_id:e.attr_id,attr_name:e.attr_name};t.setState({editModalVisible:!0,editForm:a})},t.showRemoveConfirm=function(e){x({title:"\u63d0\u793a",icon:(0,b.jsx)(f.Z,{}),content:"many"===t.state.activeTabName?"\u8be5\u64cd\u4f5c\u4f1a\u5220\u9664\u53c2\u6570\u53ca\u5176\u53c2\u6570\u503c\uff0c\u662f\u5426\u7ee7\u7eed?":"\u8be5\u64cd\u4f5c\u4f1a\u5220\u9664\u5c5e\u6027\u53ca\u5176\u5c5e\u6027\u503c\uff0c\u662f\u5426\u7ee7\u7eed?",onOk:function(){t.removeParamAndAttribute(e)},onCancel:function(){m.message.info("\u5df2\u53d6\u6d88\u5220\u9664\uff01")}})},t.updateCheckedCateId=function(e){3===e.length?(t.state.checkedCateList=e,t.state.goods_cat_threeId=e[2],t.getDefaultDynamicParams(),t.getDefaultStaticAttributes()):t.setState({checkedCateList:[]})},t.getCateList=(0,n.Z)(o().mark((function e(){var a,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g().get("categories");case 3:if(a=e.sent,200===(n=a.data).meta.status){e.next=7;break}return e.abrupt("return",m.message.error("\u83b7\u53d6\u5546\u54c1\u5206\u7c7b\u5217\u8868\u5931\u8d25\uff01"));case 7:t.setState({cateList:n.data}),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),t.getParamsAndAttributes=function(){var e=(0,n.Z)(o().mark((function e(a){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setState({loading:!0}),e.prev=1,e.next=4,g().get("categories/".concat(t.state.goods_cat_threeId,"/attributes"),{params:{sel:a}});case 4:if(n=e.sent,200===(r=n.data).meta.status){e.next=8;break}return e.abrupt("return","many"===a?m.message.error("\u83b7\u53d6\u52a8\u6001\u53c2\u6570\u5217\u8868\u5931\u8d25\uff01"):m.message.error("\u83b7\u53d6\u9759\u6001\u5c5e\u6027\u5217\u8868\u5931\u8d25\uff01"));case 8:return r.data.forEach((function(t){t.attr_vals=0===t.attr_vals.length?[]:t.attr_vals.split(","),t.tagInputVisible=!1,t.tagInputValue=""})),t.setState({loading:!1}),e.abrupt("return",r.data);case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t){return e.apply(this,arguments)}}(),t.getDefaultDynamicParams=(0,n.Z)(o().mark((function e(){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getParamsAndAttributes("many");case 2:a=e.sent,t.setState({defaultDynamicParams:a});case 4:case"end":return e.stop()}}),e)}))),t.getDefaultStaticAttributes=(0,n.Z)(o().mark((function e(){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getParamsAndAttributes("only");case 2:a=e.sent,t.setState({defaultStaticAttributes:a});case 4:case"end":return e.stop()}}),e)}))),t.updateParamAndAttribute=function(){var e=(0,n.Z)(o().mark((function e(a){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g().put("categories/".concat(t.state.goods_cat_threeId,"/attributes/").concat(a.attr_id),{attr_name:a.attr_name,attr_sel:a.attr_sel,attr_vals:a.attr_vals.join(",")});case 3:if(n=e.sent,200===n.data.meta.status){e.next=7;break}return e.abrupt("return",m.message.error("\u6dfb\u52a0\u5931\u8d25\uff01"));case 7:"many"===t.state.activeTabName?t.getDefaultDynamicParams():t.getDefaultStaticAttributes(),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",m.message.error(e.t0.message));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),t.addParamAndAttribute=(0,n.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.addFormRef.current.validateFields().then(function(){var e=(0,n.Z)(o().mark((function e(a){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g().post("categories/".concat(t.state.goods_cat_threeId,"/attributes"),{attr_name:a.attr_name,attr_sel:t.state.activeTabName});case 2:if(n=e.sent,201===n.data.meta.status){e.next=6;break}return e.abrupt("return",m.message.error("\u6dfb\u52a0\u5931\u8d25\uff01"));case 6:t.setState({addModalVisible:!1},(function(){m.message.success("\u6dfb\u52a0\u6210\u529f\uff01"),t.getDefaultDynamicParams(),t.getDefaultStaticAttributes()}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))),t.editParamAndAttribute=(0,n.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.editFormRef.current.validateFields().then(function(){var e=(0,n.Z)(o().mark((function e(a){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g().put("categories/".concat(t.state.goods_cat_threeId,"/attributes/").concat(t.state.editForm.attr_id),{attr_name:a.attr_name,attr_sel:t.state.activeTabName});case 2:if(n=e.sent,200===n.data.meta.status){e.next=6;break}return e.abrupt("return",m.message.error("\u7f16\u8f91\u5931\u8d25\uff01"));case 6:t.setState({editModalVisible:!1},(function(){m.message.success("\u7f16\u8f91\u6210\u529f\uff01"),t.getDefaultDynamicParams(),t.getDefaultStaticAttributes()}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))),t.removeParamAndAttribute=function(){var e=(0,n.Z)(o().mark((function e(a){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g().delete("categories/".concat(t.state.goods_cat_threeId,"/attributes/").concat(a));case 3:if(n=e.sent,200===n.data.meta.status){e.next=7;break}return e.abrupt("return",m.message.error("\u5220\u9664\u5931\u8d25\uff01"));case 7:"many"===t.state.activeTabName?t.getDefaultDynamicParams():t.getDefaultStaticAttributes(),m.message.success("\u5220\u9664\u6210\u529f\uff01"),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),t.handleTagInputChange=function(t,e){e.tagInputValue=t.target.value.trim()},t.handleTagInputBlur=function(e){if(""===e.tagInputValue)return e.tagInputVisible=!1,void t.forceUpdate();e.attr_vals.push(e.tagInputValue),t.updateParamAndAttribute(e)},t.handleTagInputEnter=function(e){if(""===e.tagInputValue)return e.tagInputVisible=!1,void t.forceUpdate();e.attr_vals.push(e.tagInputValue),t.updateParamAndAttribute(e)},t.handleTagClose=function(e,a){e.attr_vals.splice(a,1),t.updateParamAndAttribute(e)},t}return(0,s.Z)(a,[{key:"componentDidMount",value:function(){this.getCateList()}},{key:"componentDidCatch",value:function(t){}},{key:"render",value:function(){var t=this;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(m.Space,{direction:"vertical",size:"middle",children:[(0,b.jsx)(m.Alert,{message:"\u6ce8\u610f\uff1a\u53ea\u5141\u8bb8\u4e3a\u7b2c\u4e09\u7ea7\u5206\u7c7b\u8bbe\u7f6e\u76f8\u5173\u53c2\u6570\uff01"}),(0,b.jsx)(m.Form,{children:(0,b.jsx)(m.Form.Item,{label:"\u9009\u62e9\u5546\u54c1\u5206\u7c7b",normalize:function(t){return 3===t.length?t:[]},children:(0,b.jsx)(m.Cascader,{value:this.state.checkedCateList,placeholder:"\u8bf7\u9009\u62e9",expandTrigger:"hover",fieldNames:{label:"cat_name",value:"cat_id",children:"children"},options:this.state.cateList,onChange:this.updateCheckedCateId})})})]}),(0,b.jsxs)(m.Tabs,{activeKey:this.state.activeTabName,onChange:function(e){t.setState({activeTabName:e})},children:[(0,b.jsx)(v,{tab:"\u52a8\u6001\u53c2\u6570",children:(0,b.jsxs)(m.Space,{direction:"vertical",style:{width:"100%"},children:[(0,b.jsx)(m.Button,{type:"primary",onClick:this.showAddModal,disabled:!this.state.goods_cat_threeId,children:"\u6dfb\u52a0\u53c2\u6570"}),(0,b.jsx)(m.Table,{loading:this.state.loading,bordered:!0,columns:this.columns,dataSource:this.state.defaultDynamicParams,rowKey:function(t){return t.attr_id},expandable:{defaultExpandAllRows:!0,expandedRowRender:function(e){return(0,b.jsxs)(b.Fragment,{children:[e.attr_vals.map((function(a,n){return(0,b.jsx)(m.Tag,{color:"blue",visible:!0,closable:!0,onClose:function(){t.handleTagClose(e,n)},children:a},n)})),e.tagInputVisible?(0,b.jsx)(m.Input,{ref:t.tagInputRef,className:"tag-input",onChange:function(a){t.handleTagInputChange(a,e)},onBlur:t.handleTagInputBlur.bind(t,e),onPressEnter:t.handleTagInputEnter.bind(t,e)}):(0,b.jsxs)(m.Tag,{className:"site-tag-plus",onClick:function(a){e.tagInputVisible=!0,t.forceUpdate((function(){t.tagInputRef.current.focus()}))},children:[(0,b.jsx)(h.Z,{})," newTag"]})]})}}})]})},"many"),(0,b.jsx)(v,{tab:"\u9759\u6001\u5c5e\u6027",children:(0,b.jsxs)(m.Space,{direction:"vertical",style:{width:"100%"},children:[(0,b.jsx)(m.Button,{type:"primary",onClick:this.showAddModal,disabled:!this.state.goods_cat_threeId,children:"\u6dfb\u52a0\u5c5e\u6027"}),(0,b.jsx)(m.Table,{loading:this.state.loading,bordered:!0,columns:this.columns,dataSource:this.state.defaultStaticAttributes,rowKey:function(t){return t.attr_id},expandable:{defaultExpandAllRows:!0,expandedRowRender:function(e){return(0,b.jsxs)(b.Fragment,{children:[e.attr_vals.map((function(a,n){return(0,b.jsx)(m.Tag,{color:"blue",visible:!0,closable:!0,onClose:function(){t.handleTagClose(e,n)},children:a},n)})),e.tagInputVisible?(0,b.jsx)(m.Input,{ref:t.tagInputRef,className:"tag-input",onChange:function(a){t.handleTagInputChange(a,e)},onBlur:t.handleTagInputBlur.bind(t,e),onPressEnter:t.handleTagInputEnter.bind(t,e)}):(0,b.jsxs)(m.Tag,{className:"site-tag-plus",onClick:function(a){e.tagInputVisible=!0,t.forceUpdate((function(){t.tagInputRef.current.focus()}))},children:[(0,b.jsx)(h.Z,{})," newTag"]})]})}}})]})},"only")]}),(0,b.jsx)(m.Modal,{destroyOnClose:!0,title:"many"===this.state.activeTabName?"\u6dfb\u52a0\u52a8\u6001\u53c2\u6570":"\u6dfb\u52a0\u9759\u6001\u5c5e\u6027",visible:this.state.addModalVisible,onOk:this.addParamAndAttribute,onCancel:function(){t.setState({addModalVisible:!1})},children:(0,b.jsx)(m.Form,{ref:this.addFormRef,children:(0,b.jsx)(m.Form.Item,{name:"attr_name",label:"many"===this.state.activeTabName?"\u53c2\u6570\u540d\u79f0":"\u5c5e\u6027\u540d\u79f0",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u53c2\u6570\u540d\u79f0"}],children:(0,b.jsx)(m.Input,{})})})}),(0,b.jsx)(m.Modal,{title:"many"===this.state.activeTabName?"\u7f16\u8f91\u52a8\u6001\u53c2\u6570":"\u7f16\u8f91\u9759\u6001\u5c5e\u6027",visible:this.state.editModalVisible,destroyOnClose:!0,onOk:this.editParamAndAttribute,onCancel:function(){t.setState({editModalVisible:!1})},children:(0,b.jsx)(m.Form,{ref:this.editFormRef,initialValues:this.state.editForm,children:(0,b.jsx)(m.Form.Item,{name:"attr_name",label:"many"===this.state.activeTabName?"\u53c2\u6570\u540d\u79f0":"\u5c5e\u6027\u540d\u79f0",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u53c2\u6570\u540d\u79f0"}],children:(0,b.jsx)(m.Input,{})})})})]})}}]),a}(d.Component)},5796:function(t,e,a){a.d(e,{Z:function(){return u}});var n=a(1413),r=a(7363),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},i=a(2006),c=function(t,e){return r.createElement(i.Z,(0,n.Z)((0,n.Z)({},t),{},{ref:e,icon:s}))};c.displayName="ExclamationCircleOutlined";var u=r.forwardRef(c)},9286:function(t,e,a){a.d(e,{Z:function(){return u}});var n=a(1413),r=a(7363),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"},i=a(2006),c=function(t,e){return r.createElement(i.Z,(0,n.Z)((0,n.Z)({},t),{},{ref:e,icon:s}))};c.displayName="PlusOutlined";var u=r.forwardRef(c)}}]);
//# sourceMappingURL=424.c22fd126.chunk.js.map