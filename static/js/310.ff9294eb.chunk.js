"use strict";(self.webpackChunkreact_admin=self.webpackChunkreact_admin||[]).push([[310],{3310:function(e,t,r){r.r(t),r.d(t,{default:function(){return C}});var n=r(2982),a=r(5861),s=r(5671),o=r(3144),i=r(9340),l=r(8557),c=r(7757),u=r.n(c),d=r(7363),h=r.n(d),f=r(1821),m=r(1413),p={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"},g=r(2006),R=function(e,t){return d.createElement(g.Z,(0,m.Z)((0,m.Z)({},e),{},{ref:t,icon:p}))};R.displayName="CaretRightOutlined";var v=d.forwardRef(R),x=r(5796),b=r(7467),k=r.n(b),w=r(184),y=f.Modal.confirm,C=function(e){(0,i.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;(0,s.Z)(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).addRoleFormRef=h().createRef(),e.editRoleFormRef=h().createRef(),e.roleRules={roleName:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"}],roleDesc:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u63cf\u8ff0"}]},e.columns=[{title:"#",key:"index",render:function(e,t,r){return r+1}},{title:"\u89d2\u8272\u540d\u79f0",width:"20%",key:"roleName",dataIndex:"roleName"},{title:"\u89d2\u8272\u63cf\u8ff0",width:"40%",key:"roleDesc",dataIndex:"roleDesc"},{title:"\u64cd\u4f5c",width:"30%",key:"operation",render:function(t,r){return(0,w.jsxs)(f.Space,{children:[(0,w.jsx)(f.Button,{className:"primaryStyle",onClick:function(){e.showEditRoleModal(r.id)},children:"\u7f16\u8f91"}),(0,w.jsx)(f.Button,{className:"warningStyle",onClick:function(){e.showAllotRightModal(r)},children:"\u5206\u914d\u6743\u9650"}),(0,w.jsx)(f.Button,{className:"dangerStyle",onClick:function(){e.showRemoveRoleConfirm(r.id)},children:"\u5220\u9664"})]})}}],e.state={tagVisible:!0,removeRightConfirmVisible:!1,removeRoleConfirmVisible:!1,addRoleModalVisible:!1,editRoleModalVisible:!1,allotRightModalVisible:!1,allCheckedKeys:[],roleList:[],rightList:[],editRoleForm:{roleName:"",roleDesc:""},roleLeafRightIds:[],RoleIdOfAllotRight:"",loading:!1},e.getRoleList=function(){var t=(0,a.Z)(u().mark((function t(r){var n,a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.prev=1,t.next=4,k().get("roles");case 4:if(n=t.sent,200===(a=n.data).meta.status){t.next=8;break}return t.abrupt("return",f.message.error("\u83b7\u53d6\u89d2\u8272\u5217\u8868\u5931\u8d25\uff01"));case 8:e.setState({roleList:a.data,loading:!1}),t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(1),t.abrupt("return",f.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 14:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}(),e.getRightList=function(){var t=(0,a.Z)(u().mark((function t(r){var n,a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k().get("rights/tree");case 3:if(n=t.sent,200===(a=n.data).meta.status){t.next=7;break}return t.abrupt("return",f.message.error("\u83b7\u53d6\u6743\u9650\u5217\u8868\u5931\u8d25\uff01"));case 7:e.setState({roleList:a.data}),t.next=13;break;case 10:return t.prev=10,t.t0=t.catch(0),t.abrupt("return",f.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}(),e.getRoleLeafRightIds=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.children.forEach((function(t){if(void 0===t.children)return r.push(t.id);e.getRoleLeafRightIds(t,r)})),r},e.showRemoveRightConfirm=function(t,r){y({title:"\u63d0\u793a",icon:(0,w.jsx)(x.Z,{}),content:"\u8be5\u64cd\u4f5c\u4f1a\u5220\u9664\u8be5\u89d2\u8272\u4e0b\u7684\u5f53\u524d\u6743\u9650\u53ca\u5176\u5b50\u7ea7\u6743\u9650\uff0c\u662f\u5426\u7ee7\u7eed?",onOk:function(){e.removeRightById(t,r)},onCancel:function(){f.message.info("\u5df2\u53d6\u6d88\u5220\u9664\uff01")}})},e.showRemoveRoleConfirm=function(t){y({title:"\u63d0\u793a",icon:(0,w.jsx)(x.Z,{}),content:"\u8be5\u64cd\u4f5c\u4f1a\u5220\u9664\u8be5\u89d2\u8272\uff0c\u662f\u5426\u7ee7\u7eed?",onOk:function(){e.removeRoleById(t)},onCancel:function(){f.message.info("\u5df2\u53d6\u6d88\u5220\u9664\uff01")}})},e.showEditRoleModal=function(){var t=(0,a.Z)(u().mark((function t(r){var n,a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k().get("roles/".concat(r));case 3:if(n=t.sent,200===(a=n.data).meta.status){t.next=7;break}return t.abrupt("return",f.message.error("\u83b7\u53d6\u89d2\u8272\u4fe1\u606f\u5931\u8d25"));case 7:e.setState({editRoleModalVisible:!0,editRoleForm:a.data}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),f.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01");case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}(),e.showAllotRightModal=function(){var t=(0,a.Z)(u().mark((function t(r){var n,a,s;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k().get("rights/tree");case 3:if(n=t.sent,200===(a=n.data).meta.status){t.next=7;break}return t.abrupt("return",f.message.error("\u83b7\u53d6\u6743\u9650\u5217\u8868\u5931\u8d25"));case 7:s=e.getRoleLeafRightIds(r),e.setState({allotRightModalVisible:!0,rightList:a.data,roleLeafRightIds:s,RoleIdOfAllotRight:r.id}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),f.message.error(t.t0.message);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}(),e.removeRightById=function(){var t=(0,a.Z)(u().mark((function t(r,n){var a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k().delete("roles/".concat(r.id,"/rights/").concat(n));case 3:if(a=t.sent,200===a.data.meta.status){t.next=7;break}return t.abrupt("return",f.message.error("\u5220\u9664\u6743\u9650\u5931\u8d25\uff01"));case 7:return e.getRoleList(),t.abrupt("return",f.message.success("\u5220\u9664\u6743\u9650\u6210\u529f\uff01"));case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",f.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e,r){return t.apply(this,arguments)}}(),e.removeRoleById=function(){var t=(0,a.Z)(u().mark((function t(r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k().delete("roles/".concat(r));case 3:if(n=t.sent,200===n.data.meta.status){t.next=7;break}return t.abrupt("return",f.message.error("\u5220\u9664\u89d2\u8272\u5931\u8d25!"));case 7:return e.getRoleList(),t.abrupt("return",f.message.success("\u5220\u9664\u89d2\u8272\u6210\u529f\uff01"));case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",f.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}(),e.addRole=(0,a.Z)(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.addRoleFormRef.current.validateFields().then(function(){var t=(0,a.Z)(u().mark((function t(r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k().post("roles",{roleName:r.roleName,roleDesc:r.roleDesc});case 3:if(n=t.sent,201===n.data.meta.status){t.next=7;break}return t.abrupt("return",f.message.error("\u6dfb\u52a0\u89d2\u8272\u5931\u8d25\uff01"));case 7:e.setState({addRoleModalVisible:!1}),e.getRoleList(),f.message.success("\u6dfb\u52a0\u89d2\u8272\u4fe1\u606f\u6210\u529f"),t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",f.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}()).catch((function(){}));case 1:case"end":return t.stop()}}),t)}))),e.editRole=(0,a.Z)(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.editRoleFormRef.current.validateFields().then(function(){var t=(0,a.Z)(u().mark((function t(r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k().put("roles/".concat(e.state.editRoleForm.roleId),{roleName:r.roleName,roleDesc:r.roleDesc});case 3:if(n=t.sent,200===n.data.meta.status){t.next=7;break}return t.abrupt("return",f.message.error("\u66f4\u65b0\u89d2\u8272\u4fe1\u606f\u5931\u8d25\uff01"));case 7:e.setState({editRoleModalVisible:!1}),e.getRoleList(),f.message.success("\u66f4\u65b0\u89d2\u8272\u4fe1\u606f\u6210\u529f"),t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",f.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}()).catch((function(){}));case 1:case"end":return t.stop()}}),t)}))),e.allotRight=(0,a.Z)(u().mark((function t(){var r,n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=e.state.allCheckedKeys.join(","),t.next=4,k().post("roles/".concat(e.state.RoleIdOfAllotRight,"/rights"),{rids:r});case 4:if(n=t.sent,200===n.data.meta.status){t.next=8;break}return t.abrupt("return",f.message.error("\u5206\u914d\u6743\u9650\u5931\u8d25\uff01"));case 8:e.getRoleList(),e.setState({allotRightModalVisible:!1}),f.message.success("\u5206\u914d\u6743\u9650\u6210\u529f"),t.next=16;break;case 13:return t.prev=13,t.t0=t.catch(0),t.abrupt("return",f.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 16:case"end":return t.stop()}}),t,null,[[0,13]])}))),e}return(0,o.Z)(r,[{key:"componentDidMount",value:function(){this.getRoleList()}},{key:"render",value:function(){var e=this;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(f.Space,{direction:"vertical",style:{width:"100%"},children:[(0,w.jsx)(f.Button,{type:"primary",onClick:function(){e.setState({addRoleModalVisible:!0})},children:"\u6dfb\u52a0\u89d2\u8272"}),(0,w.jsx)(f.Table,{loading:this.state.loading,columns:this.columns,rowKey:function(e){return e.id},dataSource:this.state.roleList,expandable:{childrenColumnName:"authName",expandedRowRender:function(t){return t.children.map((function(r){return(0,w.jsxs)(f.Row,{align:"middle",children:[(0,w.jsxs)(f.Col,{span:6,children:[(0,w.jsx)(f.Tag,{closable:!0,visible:e.state.tagVisible,color:"blue",onClose:function(){e.showRemoveRightConfirm(t,r.id)},children:r.authName}),(0,w.jsx)(v,{})]}),(0,w.jsx)(f.Col,{span:18,children:r.children.map((function(r){return(0,w.jsxs)(f.Row,{align:"middle",children:[(0,w.jsxs)(f.Col,{span:6,children:[(0,w.jsx)(f.Tag,{closable:!0,color:"green",visible:e.state.tagVisible,onClose:function(){e.showRemoveRightConfirm(t,r.id)},children:r.authName}),(0,w.jsx)(v,{})]}),(0,w.jsx)(f.Col,{span:18,children:(0,w.jsx)(f.Row,{children:r.children.map((function(r){return(0,w.jsx)(f.Col,{span:6,children:(0,w.jsx)(f.Tag,{closable:!0,color:"orange",visible:e.state.tagVisible,onClose:function(){e.showRemoveRightConfirm(t,r.id)},children:r.authName})},r.id)}))})})]},r.id)}))})]},r.id)}))}},bordered:!0})]}),(0,w.jsx)(f.Modal,{title:"\u6dfb\u52a0\u89d2\u8272",visible:this.state.addRoleModalVisible,destroyOnClose:!0,onOk:this.addRole,onCancel:function(){e.setState({addRoleModalVisible:!1})},children:(0,w.jsxs)(f.Form,{ref:this.addRoleFormRef,children:[(0,w.jsx)(f.Form.Item,{name:"roleName",label:"\u89d2\u8272\u540d\u79f0",rules:this.roleRules.roleName,children:(0,w.jsx)(f.Input,{})}),(0,w.jsx)(f.Form.Item,{name:"roleDesc",label:"\u89d2\u8272\u63cf\u8ff0",rules:this.roleRules.roleDesc,children:(0,w.jsx)(f.Input,{})})]})}),(0,w.jsx)(f.Modal,{title:"\u7f16\u8f91\u89d2\u8272",visible:this.state.editRoleModalVisible,destroyOnClose:!0,onOk:this.editRole,onCancel:function(){e.setState({editRoleModalVisible:!1})},children:(0,w.jsxs)(f.Form,{initialValues:this.state.editRoleForm,ref:this.editRoleFormRef,children:[(0,w.jsx)(f.Form.Item,{name:"roleName",label:"\u89d2\u8272\u540d\u79f0",rules:this.roleRules.roleName,children:(0,w.jsx)(f.Input,{})}),(0,w.jsx)(f.Form.Item,{name:"roleDesc",label:"\u89d2\u8272\u63cf\u8ff0",rules:this.roleRules.roleDesc,children:(0,w.jsx)(f.Input,{})})]})}),(0,w.jsx)(f.Modal,{title:"\u5206\u914d\u6743\u9650",visible:this.state.allotRightModalVisible,onCancel:function(){e.setState({allotRightModalVisible:!1})},onOk:this.allotRight,children:(0,w.jsx)(f.Tree,{style:{width:"100%"},defaultExpandAll:!0,checkedKeys:this.state.roleLeafRightIds,checkable:!0,onCheck:function(t,r){var a=[].concat((0,n.Z)(t),(0,n.Z)(r.halfCheckedKeys));e.setState({roleLeafRightIds:t,allCheckedKeys:a})},treeData:this.state.rightList,fieldNames:{title:"authName",key:"id",children:"children"}})})]})}}]),r}(d.Component)},5796:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(1413),a=r(7363),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},o=r(2006),i=function(e,t){return a.createElement(o.Z,(0,n.Z)((0,n.Z)({},e),{},{ref:t,icon:s}))};i.displayName="ExclamationCircleOutlined";var l=a.forwardRef(i)}}]);
//# sourceMappingURL=310.ff9294eb.chunk.js.map