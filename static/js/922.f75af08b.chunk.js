"use strict";(self.webpackChunkreact_admin=self.webpackChunkreact_admin||[]).push([[922],{4922:function(e,t,r){r.r(t),r.d(t,{default:function(){return I}});var s=r(5861),a=r(5671),n=r(3144),i=r(9340),l=r(8557),o=r(7757),c=r.n(o),u=r(7363),d=r.n(u),m=r(1821),h=r(1413),p={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},f=r(2006),g=function(e,t){return u.createElement(f.Z,(0,h.Z)((0,h.Z)({},e),{},{ref:t,icon:p}))};g.displayName="SettingOutlined";var x=u.forwardRef(g),b=r(1752),v=r(2622),U=r(7467),w=r.n(U),k=r(184),j=m.Input.Search,y=m.Select.Option,I=function(e){(0,i.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i))).addUserFormRef=d().createRef(),e.editUserFormRef=d().createRef(),e.columns=[{title:"#",key:"index",render:function(e,t,r){return r+1}},{width:"15%",title:"\u59d3\u540d",dataIndex:"username",key:"username"},{width:"20%",title:"\u90ae\u7bb1",dataIndex:"email",key:"email"},{width:"15%",title:"\u7535\u8bdd",dataIndex:"mobile",key:"mobile"},{width:"15%",title:"\u89d2\u8272",dataIndex:"role_name",key:"role_name"},{width:"10%",title:"\u72b6\u6001",dataIndex:"mg_status",key:"mg_state",render:function(t,r){return(0,k.jsx)(m.Switch,{checked:r.mg_state,onChange:function(t){return e.onStateChange(r,t)}})}},{width:"20%",title:"\u64cd\u4f5c",key:"operation",render:function(t,r){return(0,k.jsxs)(m.Space,{children:[(0,k.jsx)(m.Tooltip,{title:"\u4fee\u6539\u7528\u6237",color:"blue",children:(0,k.jsx)(m.Button,{icon:(0,k.jsx)(b.Z,{}),className:"primaryStyle",onClick:function(){e.showEditUserModal(r.id)}})}),(0,k.jsx)(m.Tooltip,{title:"\u5206\u914d\u89d2\u8272",color:"orange",children:(0,k.jsx)(m.Button,{icon:(0,k.jsx)(x,{}),className:"warningStyle",onClick:function(){e.showSetRoleModal(r)}})}),(0,k.jsx)(m.Popconfirm,{title:"\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u7528\u6237\uff0c\u662f\u5426\u7ee7\u7eed?",onConfirm:function(){e.removeUserById(r.id)},children:(0,k.jsx)(m.Tooltip,{title:"\u5220\u9664\u7528\u6237",color:"red",children:(0,k.jsx)(m.Button,{icon:(0,k.jsx)(v.Z,{}),className:"dangerStyle"})})})]})}}],e.regEmail=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/,e.regMobile=/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,e.registerRules={username:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d"},{min:3,max:10,message:"\u7528\u6237\u540d\u7684\u957f\u5ea6\u57283~10\u4e2a\u5b57\u7b26\u4e4b\u95f4"}],password:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801"},{min:6,max:15,message:"\u5bc6\u7801\u7684\u957f\u5ea6\u57286~15\u4e2a\u5b57\u7b26\u4e4b\u95f4"}],email:[{required:!0,message:"\u8bf7\u8f93\u5165\u90ae\u7bb1"},{pattern:e.regEmail,message:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u90ae\u7bb1"}],mobile:[{required:!0,message:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7"},{pattern:e.regMobile,message:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u624b\u673a\u53f7"}]},e.state={queryInfo:{query:"",pagenum:1,pagesize:10},userList:[],userTotal:0,addUserModalVisible:!1,editUserModalVisible:!1,setRoleModalVisible:!1,editUserForm:{},userRoleInfo:{},roleList:[],selectedRoleId:"",loading:!1},e.getUserList=(0,s.Z)(c().mark((function t(){var r,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({loading:!0}),t.prev=1,t.next=4,w().get("users",{params:e.state.queryInfo});case 4:if(r=t.sent,200===(s=r.data).meta.status){t.next=8;break}return t.abrupt("return",m.message.error("\u83b7\u53d6\u7528\u6237\u5217\u8868\u5931\u8d25\uff01"));case 8:e.setState({userList:s.data.users,userTotal:s.data.total,loading:!1}),t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(1),t.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 14:case"end":return t.stop()}}),t,null,[[1,11]])}))),e.resetSearch=function(t){""===t.target.value&&(e.state.queryInfo.query="",e.getUserList())},e.searchUser=function(t){e.state.queryInfo.query=t,e.getUserList()},e.onStateChange=function(){var t=(0,s.Z)(c().mark((function t(r,s){var a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().put("users/".concat(r.id,"/state/").concat(s));case 3:if(a=t.sent,200===a.data.meta.status){t.next=7;break}return t.abrupt("return",m.message.error("\u66f4\u65b0\u7528\u6237\u72b6\u6001\u5931\u8d25\uff01"));case 7:e.getUserList(),m.message.success("\u66f4\u65b0\u7528\u6237\u72b6\u6001\u6210\u529f\uff01"),t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e,r){return t.apply(this,arguments)}}(),e.onPageChange=function(t,r){e.state.queryInfo.pagenum=t,e.state.queryInfo.pagesize=r,e.getUserList()},e.addUserModalClosed=function(){e.setState({addUserModalVisible:!1}),e.addUserFormRef.current.resetFields()},e.addUser=function(t){e.addUserFormRef.current.validateFields().then(function(){var t=(0,s.Z)(c().mark((function t(r){var s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().post("users",r);case 3:s=t.sent,201!==s.data.meta.status&&m.message.error("\u6dfb\u52a0\u7528\u6237\u5931\u8d25\uff01"),m.message.success("\u6dfb\u52a0\u7528\u6237\u6210\u529f\uff01"),e.setState({addUserModalVisible:!1}),e.getUserList(),t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}()).catch((function(){}))},e.showEditUserModal=function(){var t=(0,s.Z)(c().mark((function t(r){var s,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().get("users/"+r);case 3:if(s=t.sent,200===(a=s.data).meta.status){t.next=7;break}return t.abrupt("return",m.message.error("\u67e5\u8be2\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff01"));case 7:e.setState({editUserModalVisible:!0,editUserForm:a.data}),t.next=13;break;case 10:return t.prev=10,t.t0=t.catch(0),t.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}(),e.editUserModalClosed=function(){e.setState({editUserModalVisible:!1})},e.editUser=function(){e.editUserFormRef.current.validateFields().then(function(){var t=(0,s.Z)(c().mark((function t(r){var s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().put("users/"+e.state.editUserForm.id,{email:r.email,mobile:r.mobile});case 3:if(s=t.sent,200===s.data.meta.status){t.next=7;break}return t.abrupt("return",m.message.error("\u66f4\u65b0\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff01"));case 7:e.setState({editUserModalVisible:!1}),e.getUserList(),m.message.success("\u66f4\u65b0\u7528\u6237\u4fe1\u606f\u6210\u529f"),t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}()).catch((function(){}))},e.removeUserById=function(){var t=(0,s.Z)(c().mark((function t(r){var s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().delete("users/"+r);case 3:if(s=t.sent,200===s.data.meta.status){t.next=7;break}return t.abrupt("return",m.message.error("\u5220\u9664\u7528\u6237\u5931\u8d25\uff01"));case 7:m.message.success("\u5220\u9664\u7528\u6237\u6210\u529f\uff01"),e.getUserList(),t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(0),t.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}(),e.showSetRoleModal=function(){var t=(0,s.Z)(c().mark((function t(r){var s,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.state.userRoleInfo=r,t.next=4,w().get("roles");case 4:if(s=t.sent,200===(a=s.data).meta.status){t.next=8;break}return t.abrupt("return",m.message.error("\u83b7\u53d6\u89d2\u8272\u5217\u8868\u5931\u8d25\uff01"));case 8:e.state.roleList=a.data,e.setState({setRoleModalVisible:!0}),t.next=15;break;case 12:return t.prev=12,t.t0=t.catch(0),t.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}(),e.setRoleModalClosed=function(t){e.setState({setRoleModalVisible:!1})},e.saveUserRoleId=function(t){e.state.selectedRoleId=t},e.setUserRole=(0,s.Z)(c().mark((function t(){var r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.state.selectedRoleId){t.next=2;break}return t.abrupt("return",m.message.error("\u8bf7\u9009\u62e9\u8981\u5206\u914d\u7684\u89d2\u8272\uff01"));case 2:return t.prev=2,t.next=5,w().put("users/".concat(e.state.userRoleInfo.id,"/role"),{rid:e.state.selectedRoleId});case 5:if(r=t.sent,200===r.data.meta.status){t.next=9;break}return t.abrupt("return",m.message.error("\u66f4\u65b0\u7528\u6237\u89d2\u8272\u5931\u8d25\uff01"));case 9:m.message.success("\u66f4\u65b0\u7528\u6237\u89d2\u8272\u6210\u529f\uff01"),e.setState({setRoleModalVisible:!1}),e.getUserList(),t.next=17;break;case 14:return t.prev=14,t.t0=t.catch(2),t.abrupt("return",m.message.error("\u7f51\u7edc\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01"));case 17:case"end":return t.stop()}}),t,null,[[2,14]])}))),e}return(0,n.Z)(r,[{key:"componentDidMount",value:function(){this.getUserList()}},{key:"render",value:function(){var e=this;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(m.Space,{direction:"vertical",style:{width:"100%"},children:[(0,k.jsxs)(m.Space,{size:"large",children:[(0,k.jsx)(j,{size:"large",allowClear:!0,placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",onChange:this.resetSearch,onSearch:this.searchUser}),(0,k.jsx)(m.Button,{type:"primary",size:"large",onClick:function(){e.setState({addUserModalVisible:!0})},children:"\u6dfb\u52a0\u7528\u6237"})]}),(0,k.jsx)(m.Table,{loading:this.state.loading,columns:this.columns,dataSource:this.state.userList,rowKey:function(e){return e.id},pagination:{position:["none"]},bordered:!0}),(0,k.jsx)(m.Pagination,{total:this.state.userTotal,current:this.state.queryInfo.pagenum,size:"small",pageSizeOptions:[1,2,5,10],defaultPageSize:this.state.queryInfo.pagesize,showSizeChanger:!0,onChange:this.onPageChange,showQuickJumper:!0,showTotal:function(e){return"\u5171 ".concat(e," \u6761")}})]}),(0,k.jsx)(m.Modal,{visible:this.state.addUserModalVisible,title:"\u6dfb\u52a0\u7528\u6237",onOk:this.addUser,onCancel:this.addUserModalClosed,children:(0,k.jsxs)(m.Form,{labelCol:{span:3},ref:this.addUserFormRef,children:[(0,k.jsx)(m.Form.Item,{label:"\u7528\u6237\u540d",name:"username",rules:this.registerRules.username,validateTrigger:["onChange","onSubmit"],children:(0,k.jsx)(m.Input,{})}),(0,k.jsx)(m.Form.Item,{label:"\u5bc6\u7801",name:"password",rules:this.registerRules.password,children:(0,k.jsx)(m.Input.Password,{})}),(0,k.jsx)(m.Form.Item,{label:"\u90ae\u7bb1",name:"email",rules:this.registerRules.email,children:(0,k.jsx)(m.Input,{})}),(0,k.jsx)(m.Form.Item,{label:"\u624b\u673a",name:"mobile",rules:this.registerRules.mobile,children:(0,k.jsx)(m.Input,{})})]})}),(0,k.jsx)(m.Modal,{title:"\u4fee\u6539\u7528\u6237",visible:this.state.editUserModalVisible,onCancel:this.editUserModalClosed,onOk:this.editUser,destroyOnClose:!0,children:(0,k.jsxs)(m.Form,{initialValues:this.state.editUserForm,labelCol:{span:3},ref:this.editUserFormRef,children:[(0,k.jsx)(m.Form.Item,{name:"username",label:"\u7528\u6237\u540d",children:(0,k.jsx)(m.Input,{disabled:!0})}),(0,k.jsx)(m.Form.Item,{name:"email",label:"\u90ae\u7bb1",rules:this.registerRules.email,children:(0,k.jsx)(m.Input,{})}),(0,k.jsx)(m.Form.Item,{name:"mobile",label:"\u624b\u673a\u53f7",rules:this.registerRules.mobile,children:(0,k.jsx)(m.Input,{})})]})}),(0,k.jsx)(m.Modal,{title:"\u5206\u914d\u89d2\u8272",visible:this.state.setRoleModalVisible,onCancel:this.setRoleModalClosed,onOk:this.setUserRole,destroyOnClose:!0,children:(0,k.jsxs)("div",{children:[(0,k.jsxs)("p",{children:["\u5f53\u524d\u7684\u7528\u6237\uff1a",this.state.userRoleInfo.username]}),(0,k.jsxs)("p",{children:["\u5f53\u524d\u7684\u89d2\u8272\uff1a",this.state.userRoleInfo.role_name]}),(0,k.jsx)("span",{children:"\u5206\u914d\u65b0\u89d2\u8272\uff1a"}),(0,k.jsx)(m.Select,{style:{width:120},onSelect:this.saveUserRoleId,placeholder:"\u8bf7\u9009\u62e9",children:this.state.roleList.map((function(e){return(0,k.jsx)(y,{children:e.roleName},e.id)}))})]})})]})}}]),r}(u.Component)},2622:function(e,t,r){r.d(t,{Z:function(){return o}});var s=r(1413),a=r(7363),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},i=r(2006),l=function(e,t){return a.createElement(i.Z,(0,s.Z)((0,s.Z)({},e),{},{ref:t,icon:n}))};l.displayName="DeleteOutlined";var o=a.forwardRef(l)},1752:function(e,t,r){r.d(t,{Z:function(){return o}});var s=r(1413),a=r(7363),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},i=r(2006),l=function(e,t){return a.createElement(i.Z,(0,s.Z)((0,s.Z)({},e),{},{ref:t,icon:n}))};l.displayName="EditOutlined";var o=a.forwardRef(l)}}]);
//# sourceMappingURL=922.f75af08b.chunk.js.map